<body style="margin: 0; overflow: hidden;">


</body>


<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Location-based AR.js demo</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

     <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script> -->
</head>


<body style="margin: 0; overflow: hidden;">
      <a-scene vr-mode-ui="enabled: false" embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-text value="JMC00210" look-at="[gps-camera]" scale="1 1 1"
            gps-entity-place="latitude: 33.81578; longitude: 130.87189;"></a-text>


        <a-camera gps-camera="minDistance:0.5; maxDistance:0.5" rotation-reader> </a-camera>
    </a-scene> 

<script>
var rwlat = 1;
var rwlon = 1;
var taglat = 1;
var taglon = 1;



  $.getJSON("http://172.16.1.45:8080/qpe/getTagPosition?version=2&humanReadable=true&tag=a4da22e1f2d8&id=Format002", function(datatag) {
  taglat = datatag.tags[0].smoothedPositionWGS84[0];
  taglon = (datatag.tags[0].smoothedPositionWGS84[1]);
  console.log(taglat,taglon);
});

 $.getJSON("http://172.16.1.45:8080/qpe/getTagPosition?version=2&humanReadable=true&tag=a4da22e204cc&id=Format002", function(datarw) {
  rwlat = datarw.tags[0].smoothedPositionWGS84[0];
  rwlon = (datarw.tags[0].smoothedPositionWGS84[1]);
  console.log(rwlat,rwlon);
}); 

calculateDistance(rwlat, rwlon, taglat, taglon);

function calculateDistance(rwlat, rwlon, taglat, taglon)
  {    

      //radians
      rwlat = (rwlat * 2.0 * Math.PI) / 60.0 / 360.0;      
      rwlon = (rwlon * 2.0 * Math.PI) / 60.0 / 360.0;    
      taglat = (taglat * 2.0 * Math.PI) / 60.0 / 360.0;   
      taglon = (taglon * 2.0 * Math.PI) / 60.0 / 360.0;      
      
      console.log(rwlat,rwlon,taglat,taglon);


      // use to different earth axis length    
      var a = 6378137.0;        // Earth Major Axis (WGS84)    
      var b = 6356752.3142;     // Minor Axis    
      var f = (a-b) / a;        // "Flattening"    
      var e = 2.0*f - f*f;      // "Eccentricity"      

      var resDist = 0;

      var beta = (a / Math.sqrt( 1.0 - e * Math.sin( rwlat ) * Math.sin( rwlat )));    
      var cos = Math.cos( rwlat );    
      var x = beta * cos * Math.cos( rwlon );    
      var y = beta * cos * Math.sin( rwlon );    
      var z = beta * ( 1 - e ) * Math.sin( rwlat );      

      beta = ( a / Math.sqrt( 1.0 -  e * Math.sin( taglat ) * Math.sin( taglat )));    
      cos = Math.cos( taglat );   
      x -= (beta * cos * Math.cos( taglon ));    
      y -= (beta * cos * Math.sin( taglon ));    
      z -= (beta * (1 - e) * Math.sin( taglat ));       

      resDist = (Math.sqrt( (x*x) + (y*y) + (z*z) )/1000);
      console.log("resdist: " + resDist);  

      if (resDist < 4){
                    console.log("ok");
                    document.querySelector("a-text").value.visible == true;
                } else {
                    // MARKER IS HIDDEN
                    console.log("hide");

                    document.querySelector("a-text").value.visible == false;
                }
      
      
      AFRAME.registerComponent('markerhandler', {
            tick: function () {
              if (resDist < 4){
                    console.log("ok");
                    document.querySelector("a-text").value.visible == true;
                } else {
                    // MARKER IS HIDDEN
                    console.log("hide");

                    document.querySelector("a-text").value.visible == false;
                }
            }
        });

      return (Math.sqrt( (x*x) + (y*y) + (z*z) )/1000);  
    }

    </script>
</body>

</html>
